<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div id="app"></div>
    </div>

    <script>
        class FitnessApp extends HTMLElement {
            constructor() {
                super();
                this.sessionId = null;
                this.currentStep = 1;
                this.totalSteps = 5;
                this.userData = {
                    step1: {},
                    step2: {},
                    step3: {},
                    step4: {},
                    step5: {}
                };
                this.isLoading = false;
            }

            async connectedCallback() {
                await this.startSession();
                this.render();
            }

            async startSession() {
                try {
                    const response = await fetch('/api/start_session', {
                        method: 'POST'
                    });
                    const data = await response.json();
                    this.sessionId = data.session_id;
                    console.log('Session started:', this.sessionId);
                } catch (error) {
                    console.error('Failed to start session:', error);
                    this.showError('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                }
            }

            async saveStep(stepData) {
                this.isLoading = true;
                this.render();

                try {
                    const response = await fetch(`/api/step/${this.currentStep}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            session_id: this.sessionId,
                            ...stepData
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Failed to save step:', error);
                    this.showError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                    return null;
                } finally {
                    this.isLoading = false;
                }
            }

            async generateProgram() {
                this.isLoading = true;
                this.render();

                try {
                    const response = await fetch('/api/generate_program', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            session_id: this.sessionId
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Failed to generate program:', error);
                    this.showError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                    return null;
                } finally {
                    this.isLoading = false;
                }
            }

            render() {
                this.innerHTML = `
                    <div class="max-w-2xl mx-auto fade-in">
                        <h1 class="text-3xl font-bold text-center mb-8 text-blue-600">
                            üèãÔ∏è –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
                        </h1>

                        ${this.isLoading ? this.renderLoader() : ''}

                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <div class="mb-6">
                                <div class="flex justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-600">–ü—Ä–æ–≥—Ä–µ—Å—Å</span>
                                    <span class="text-sm font-medium text-gray-600">–®–∞–≥ ${this.currentStep} –∏–∑ ${this.totalSteps}</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5">
                                    <div class="bg-blue-600 h-2.5 rounded-full transition-all duration-300"
                                         style="width: ${(this.currentStep / this.totalSteps) * 100}%">
                                    </div>
                                </div>
                            </div>

                            <div id="step-content" class="min-h-[400px]">
                                ${this.renderStep()}
                            </div>

                            ${this.currentStep <= this.totalSteps ? this.renderNavigation() : ''}
                        </div>
                    </div>
                `;
            }

            renderLoader() {
                return `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                        <div class="bg-white p-6 rounded-lg shadow-lg">
                            <div class="flex items-center space-x-3">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                                <span class="text-gray-700">${this.currentStep === 6 ? '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É...' : '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderNavigation() {
                return `
                    <div class="flex justify-between mt-6 pt-6 border-t">
                        <button onclick="app.prevStep()"
                                class="px-4 py-2 text-gray-600 hover:text-gray-800 ${this.currentStep === 1 ? 'invisible' : ''}">
                            ‚Üê –ù–∞–∑–∞–¥
                        </button>
                        <div class="flex space-x-3">
                            ${this.currentStep < this.totalSteps ? `
                                <button onclick="app.nextStep()"
                                        class="px-6 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition disabled:opacity-50"
                                        id="next-btn">
                                    –î–∞–ª–µ–µ
                                </button>
                            ` : `
                                <button onclick="app.finalize()"
                                        class="px-6 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition"
                                        id="generate-btn">
                                    –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }

            renderStep() {
                const steps = {
                    1: this.renderStep1(),
                    2: this.renderStep2(),
                    3: this.renderStep3(),
                    4: this.renderStep4(),
                    5: this.renderStep5(),
                    6: this.renderResult()
                };
                return steps[this.currentStep] || this.renderStep1();
            }

            renderStep1() {
                return `
                    <div class="fade-in">
                        <h2 class="text-2xl font-semibold mb-6 text-gray-800">–®–∞–≥ 1: –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ</h2>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–ü–æ–ª</label>
                                <div class="flex space-x-4">
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="gender" value="male" class="w-4 h-4 text-blue-600"
                                               ${this.userData.step1.gender === 'male' ? 'checked' : ''}>
                                        <span class="text-gray-700">–ú—É–∂—Å–∫–æ–π</span>
                                    </label>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="radio" name="gender" value="female" class="w-4 h-4 text-blue-600"
                                               ${this.userData.step1.gender === 'female' ? 'checked' : ''}>
                                        <span class="text-gray-700">–ñ–µ–Ω—Å–∫–∏–π</span>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–í–æ–∑—Ä–∞—Å—Ç (–ª–µ—Ç)</label>
                                <input type="number" id="age"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                       min="10" max="100"
                                       value="${this.userData.step1.age || ''}"
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-gray-700">–†–æ—Å—Ç (—Å–º)</label>
                                    <input type="number" id="height"
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           min="100" max="250"
                                           value="${this.userData.step1.height || ''}"
                                           placeholder="–†–æ—Å—Ç">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-gray-700">–í–µ—Å (–∫–≥)</label>
                                    <input type="number" id="weight"
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                           min="30" max="200"
                                           value="${this.userData.step1.weight || ''}"
                                           placeholder="–í–µ—Å">
                                </div>
                            </div>

                            <div class="text-sm text-gray-500">
                                <p>‚úì –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–º–æ–≥—É—Ç —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderStep2() {
                return `
                    <div class="fade-in">
                        <h2 class="text-2xl font-semibold mb-6 text-gray-800">–®–∞–≥ 2: –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å</h2>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å</label>
                                <div class="space-y-3">
                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step2.goal === 'bench_100kg' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="goal" value="bench_100kg" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step2.goal === 'bench_100kg' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–ñ–∏–º –ª–µ–∂–∞ 100 –∫–≥</span>
                                            <p class="text-sm text-gray-600 mt-1">–†–∞–∑–≤–∏—Ç—å —Å–∏–ª—É –≥—Ä—É–¥–Ω—ã—Ö –º—ã—à—Ü –∏ —Ç—Ä–∏—Ü–µ–ø—Å–æ–≤</p>
                                        </div>
                                    </label>

                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step2.goal === 'lose_7kg' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="goal" value="lose_7kg" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step2.goal === 'lose_7kg' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–ü–æ—Ö—É–¥–µ—Ç—å –Ω–∞ 7 –∫–≥</span>
                                            <p class="text-sm text-gray-600 mt-1">–°–±—Ä–æ—Å–∏—Ç—å –ª–∏—à–Ω–∏–π –≤–µ—Å –∏ —É–ª—É—á—à–∏—Ç—å —Ä–µ–ª—å–µ—Ñ</p>
                                        </div>
                                    </label>

                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step2.goal === 'pullups_12' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="goal" value="pullups_12" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step2.goal === 'pullups_12' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–ü–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å—Å—è 12 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥</span>
                                            <p class="text-sm text-gray-600 mt-1">–†–∞–∑–≤–∏—Ç—å —Å–∏–ª—É —Å–ø–∏–Ω—ã –∏ –±–∏—Ü–µ–ø—Å–æ–≤</p>
                                        </div>
                                    </label>

                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step2.goal === 'gain_4kg' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="goal" value="gain_4kg" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step2.goal === 'gain_4kg' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–ù–∞–±—Ä–∞—Ç—å 4 –∫–≥ –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã</span>
                                            <p class="text-sm text-gray-600 mt-1">–£–≤–µ–ª–∏—á–∏—Ç—å –æ–±—ä–µ–º –º—ã—à—Ü –∏ —Å–∏–ª—É</p>
                                        </div>
                                    </label>

                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step2.goal === 'custom' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="goal" value="custom" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step2.goal === 'custom' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç</span>
                                            <input type="text" id="custom-goal"
                                                   class="w-full mt-2 p-2 border border-gray-300 rounded ${!this.userData.step2.goal || this.userData.step2.goal !== 'custom' ? 'hidden' : ''}"
                                                   placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª—å..."
                                                   value="${this.userData.step2.custom_goal || ''}">
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–°—Ä–æ–∫ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–∏ (–º–µ—Å—è—Ü–µ–≤)</label>
                                <input type="range" id="months" min="1" max="12" step="1"
                                       class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                       value="${this.userData.step2.months || 3}">
                                <div class="flex justify-between mt-1">
                                    <span class="text-sm text-gray-600">1 –º–µ—Å—è—Ü</span>
                                    <span id="months-value" class="font-medium text-blue-600">${this.userData.step2.months || 3} –º–µ—Å—è—Ü–µ–≤</span>
                                    <span class="text-sm text-gray-600">12 –º–µ—Å—è—Ü–µ–≤</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderStep3() {
                return `
                    <div class="fade-in">
                        <h2 class="text-2xl font-semibold mb-6 text-gray-800">–®–∞–≥ 3: –¢–µ–∫—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –æ–ø—ã—Ç</h2>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–í–∞—à–∏ –ª—É—á—à–∏–µ —Å–∏–ª–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</label>
                                <textarea id="current-results" rows="4"
                                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∂–∏–º –ª–µ–∂–∞ - 80 –∫–≥, –ø—Ä–∏—Å–µ–¥ - 100 –∫–≥, —Å—Ç–∞–Ω–æ–≤–∞—è - 120 –∫–≥...">${this.userData.step3.current_results || ''}</textarea>
                                <p class="text-sm text-gray-500 mt-1">–û–ø–∏—à–∏—Ç–µ –≤–∞—à–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è—Ö</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–ö–æ–≥–¥–∞ –≤—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑?</label>
                                <div class="space-y-3">
                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step3.last_trained === 'currently' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="last_trained" value="currently" class="mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step3.last_trained === 'currently' ? 'checked' : ''}>
                                        <span>–°–µ–π—á–∞—Å —Ç—Ä–µ–Ω–∏—Ä—É—é—Å—å</span>
                                    </label>

                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step3.last_trained === 'lt_3_months' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="last_trained" value="lt_3_months" class="mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step3.last_trained === 'lt_3_months' ? 'checked' : ''}>
                                        <span>–ú–µ–Ω–µ–µ 3 –º–µ—Å—è—Ü–µ–≤ –Ω–∞–∑–∞–¥</span>
                                    </label>

                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step3.last_trained === '3_6_months' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="last_trained" value="3_6_months" class="mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step3.last_trained === '3_6_months' ? 'checked' : ''}>
                                        <span>3-6 –º–µ—Å—è—Ü–µ–≤ –Ω–∞–∑–∞–¥</span>
                                    </label>

                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step3.last_trained === '6_12_months' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="last_trained" value="6_12_months" class="mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step3.last_trained === '6_12_months' ? 'checked' : ''}>
                                        <span>6-12 –º–µ—Å—è—Ü–µ–≤ –Ω–∞–∑–∞–¥</span>
                                    </label>

                                    <label class="flex items-center p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step3.last_trained === 'gt_year' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="last_trained" value="gt_year" class="mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step3.last_trained === 'gt_year' ? 'checked' : ''}>
                                        <span>–ë–æ–ª—å—à–µ –≥–æ–¥–∞ –Ω–∞–∑–∞–¥</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderStep4() {
                return `
                    <div class="fade-in">
                        <h2 class="text-2xl font-semibold mb-6 text-gray-800">–®–∞–≥ 4: –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –≤—ã –º–æ–∂–µ—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è?</label>
                                <div class="flex space-x-2">
                                    ${[1, 2, 3, 4, 5, 6].map(num => `
                                        <button type="button"
                                                class="flex-1 py-3 text-center border rounded-lg ${this.userData.step4.workouts_per_week === num ? 'bg-blue-500 text-white border-blue-500' : 'border-gray-300 hover:border-blue-500'}"
                                                onclick="app.selectWorkoutsPerWeek(${num})">
                                            ${num}
                                        </button>
                                    `).join('')}
                                </div>
                                <p class="text-sm text-gray-500 mt-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ –Ω–µ–¥–µ–ª—é</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</label>
                                <div class="grid grid-cols-4 gap-2">
                                    ${[30, 45, 60, 75, 90, 105, 120].map(minutes => `
                                        <button type="button"
                                                class="py-3 text-center border rounded-lg ${this.userData.step4.workout_duration === minutes ? 'bg-blue-500 text-white border-blue-500' : 'border-gray-300 hover:border-blue-500'}"
                                                onclick="app.selectWorkoutDuration(${minutes})">
                                            ${minutes} –º–∏–Ω
                                        </button>
                                    `).join('')}
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —Å—Ç–∏–ª—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</label>
                                <div class="space-y-3">
                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step4.training_style === 'balanced' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="training_style" value="balanced" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step4.training_style === 'balanced' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</span>
                                            <p class="text-sm text-gray-600 mt-1">–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤ –∏ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏—è</p>
                                        </div>
                                    </label>

                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step4.training_style === 'strength' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="training_style" value="strength" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step4.training_style === 'strength' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–°–∏–ª–æ–≤–æ–π</span>
                                            <p class="text-sm text-gray-600 mt-1">–ë–æ–ª—å—à–µ –ø–æ–¥—Ö–æ–¥–æ–≤, –º–µ–Ω—å—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π - –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∏–ª—ã</p>
                                        </div>
                                    </label>

                                    <label class="flex items-start p-3 border border-gray-300 rounded-lg hover:border-blue-500 cursor-pointer ${this.userData.step4.training_style === 'hypertrophy' ? 'border-blue-500 bg-blue-50' : ''}">
                                        <input type="radio" name="training_style" value="hypertrophy" class="mt-1 mr-3 w-4 h-4 text-blue-600"
                                               ${this.userData.step4.training_style === 'hypertrophy' ? 'checked' : ''}>
                                        <div>
                                            <span class="font-medium">–ì–∏–ø–µ—Ä—Ç—Ä–æ—Ñ–∏—è/–í—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å</span>
                                            <p class="text-sm text-gray-600 mt-1">–ú–µ–Ω—å—à–µ –ø–æ–¥—Ö–æ–¥–æ–≤, –±–æ–ª—å—à–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π - –¥–ª—è —Ä–æ—Å—Ç–∞ –º—ã—à—Ü –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏</p>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderStep5() {
                return `
                    <div class="fade-in">
                        <h2 class="text-2xl font-semibold mb-6 text-gray-800">–®–∞–≥ 5: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</h2>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –∑–¥–æ—Ä–æ–≤—å—é</label>
                                <textarea id="health-restrictions" rows="3"
                                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–ª–µ–Ω—è–º–∏, –±–æ–ª—å –≤ –ø–æ—è—Å–Ω–∏—Ü–µ, –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—è...">${this.userData.step5.health_restrictions || ''}</textarea>
                                <p class="text-sm text-gray-500 mt-1">–í–∞–∂–Ω–æ! –≠—Ç–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±—É–¥—É—Ç —Å—Ç—Ä–æ–≥–æ —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2 text-gray-700">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</label>
                                <textarea id="preferences" rows="3"
                                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Ö–æ—á—É –Ω–∞–±—Ä–∞—Ç—å –º–∞—Å—Å—É –≤ –Ω–æ–≥–∞—Ö, —É–¥–µ–ª–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–µ—Å—Å—É, –Ω–µ –ª—é–±–ª—é –∫–∞—Ä–¥–∏–æ...">${this.userData.step5.preferences || ''}</textarea>
                                <p class="text-sm text-gray-500 mt-1">–ß—Ç–æ –¥–ª—è –≤–∞—Å –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ? –ö–∞–∫–∏–µ –∑–æ–Ω—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–≤–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å?</p>
                            </div>

                            <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <div class="flex items-start">
                                    <div class="flex-shrink-0 text-blue-500 mt-0.5">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <p class="text-sm text-blue-700">
                                            <strong>–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:</strong> –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∏–º–µ–Ω–Ω–æ –¥–ª—è –≤–∞—Å.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderResult() {
                return `
                    <div class="fade-in">
                        <h2 class="text-2xl font-semibold mb-6 text-green-600">üéâ –í–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≥–æ—Ç–æ–≤–∞!</h2>

                        <div class="mb-6 p-4 bg-green-50 rounded-lg border border-green-200">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 text-green-500">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-green-700">
                                        –ü—Ä–æ–≥—Ä–∞–º–º–∞ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤–∞—à –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div id="program-content" class="bg-gray-50 border border-gray-200 rounded-lg p-6 whitespace-pre-wrap font-mono text-gray-800 max-h-[500px] overflow-y-auto"></div>

                        <div class="mt-6 flex justify-between">
                            <button onclick="app.startNew()"
                                    class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                </svg>
                                –ù–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
                            </button>
                            <button onclick="app.downloadProgram()"
                                    class="px-6 py-3 bg-green-500 text-white rounded-lg hover:bg-green-600 transition flex items-center">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                –°–∫–∞—á–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É
                            </button>
                        </div>
                    </div>
                `;
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
            selectWorkoutsPerWeek(num) {
                this.userData.step4.workouts_per_week = num;
                this.render();
            }

            selectWorkoutDuration(minutes) {
                this.userData.step4.workout_duration = minutes;
                this.render();
            }

            async nextStep() {
                const stepData = this.getStepData(this.currentStep);
                if (!this.validateStep(this.currentStep, stepData)) {
                    return;
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ
                this.userData[`step${this.currentStep}`] = stepData;

                const result = await this.saveStep(stepData);
                if (result && result.status === 'success') {
                    if (this.currentStep < this.totalSteps) {
                        this.currentStep++;
                        this.render();
                        this.attachEventListeners();
                    }
                }
            }

            async prevStep() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.render();
                    this.attachEventListeners();
                }
            }

            async finalize() {
                const stepData = this.getStepData(this.currentStep);
                if (!this.validateStep(this.currentStep, stepData)) {
                    return;
                }

                this.userData[`step${this.currentStep}`] = stepData;
                await this.saveStep(stepData);

                this.currentStep = 6;
                this.render();

                const result = await this.generateProgram();
                if (result && result.content) {
                    document.getElementById('program-content').textContent = result.content;
                }
            }

            getStepData(step) {
                switch(step) {
                    case 1:
                        const genderRadio = document.querySelector('input[name="gender"]:checked');
                        return {
                            gender: genderRadio ? genderRadio.value : null,
                            age: parseInt(document.getElementById('age')?.value) || null,
                            height: parseInt(document.getElementById('height')?.value) || null,
                            weight: parseInt(document.getElementById('weight')?.value) || null
                        };
                    case 2:
                        const goalRadio = document.querySelector('input[name="goal"]:checked');
                        const customGoalInput = document.getElementById('custom-goal');
                        return {
                            goal: goalRadio ? goalRadio.value : null,
                            custom_goal: goalRadio?.value === 'custom' ? (customGoalInput?.value || '') : '',
                            months: parseInt(document.getElementById('months')?.value) || 3
                        };
                    case 3:
                        const lastTrainedRadio = document.querySelector('input[name="last_trained"]:checked');
                        return {
                            current_results: document.getElementById('current-results')?.value || '',
                            last_trained: lastTrainedRadio ? lastTrainedRadio.value : null
                        };
                    case 4:
                        const styleRadio = document.querySelector('input[name="training_style"]:checked');
                        return {
                            workouts_per_week: this.userData.step4.workouts_per_week || null,
                            workout_duration: this.userData.step4.workout_duration || null,
                            training_style: styleRadio ? styleRadio.value : null
                        };
                    case 5:
                        return {
                            health_restrictions: document.getElementById('health-restrictions')?.value || '',
                            preferences: document.getElementById('preferences')?.value || ''
                        };
                    default:
                        return {};
                }
            }

            validateStep(step, data) {
                switch(step) {
                    case 1:
                        if (!data.gender || !data.age || !data.height || !data.weight) {
                            this.showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                            return false;
                        }
                        if (data.age < 10 || data.age > 100) {
                            this.showError('–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 10 –¥–æ 100 –ª–µ—Ç');
                            return false;
                        }
                        return true;
                    case 2:
                        if (!data.goal) {
                            this.showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å');
                            return false;
                        }
                        if (data.goal === 'custom' && !data.custom_goal) {
                            this.showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –≤–∞—à—É —Ü–µ–ª—å');
                            return false;
                        }
                        return true;
                    // ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤
                    default:
                        return true;
                }
            }

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 fade-in';
                errorDiv.innerHTML = `
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        ${message}
                    </div>
                `;
                document.body.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 5000);
            }

            attachEventListeners() {
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ –º–µ—Å—è—Ü–µ–≤
                const monthsSlider = document.getElementById('months');
                const monthsValue = document.getElementById('months-value');
                if (monthsSlider && monthsValue) {
                    monthsSlider.addEventListener('input', (e) => {
                        monthsValue.textContent = `${e.target.value} –º–µ—Å—è—Ü–µ–≤`;
                    });
                }

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ü–µ–ª–∏
                const customGoalRadio = document.querySelector('input[name="goal"][value="custom"]');
                const customGoalInput = document.getElementById('custom-goal');
                if (customGoalRadio && customGoalInput) {
                    customGoalRadio.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            customGoalInput.classList.remove('hidden');
                        }
                    });

                    Array.from(document.querySelectorAll('input[name="goal"]')).forEach(radio => {
                        if (radio.value !== 'custom') {
                            radio.addEventListener('change', () => {
                                customGoalInput.classList.add('hidden');
                            });
                        }
                    });
                }
            }

            startNew() {
                this.currentStep = 1;
                this.userData = {
                    step1: {}, step2: {}, step3: {}, step4: {}, step5: {}
                };
                this.startSession();
                this.render();
            }

            downloadProgram() {
                const content = document.getElementById('program-content').textContent;
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `–ø—Ä–æ–≥—Ä–∞–º–º–∞_—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫_${new Date().toLocaleDateString()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
        customElements.define('fitness-app', FitnessApp);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            const app = new FitnessApp();
            document.getElementById('app').appendChild(app);
            window.app = app;
        });
    </script>
</body>
</html>